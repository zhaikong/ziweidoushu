# 紫微斗数命盘分析系统

一个完整的全栈应用，用于接收案主的紫微斗数命盘信息，通过AI进行深度分析，并生成精美的中国传统风格可视化界面。

## ✨ 功能特点

- 📝 **命盘文本解析**：自动解析文墨天机格式的紫微斗数命盘数据
- 🤖 **AI智能分析**：使用Gemini API进行专业的命理分析
- 🎨 **精美界面**：中国传统风格设计，金色主题，流光效果
- 📊 **命盘可视化**：Canvas绘制十二宫位圆形图
- 📈 **流年运势**：展示过去5年和未来10年的运势变化
- 💾 **多案主管理**：支持保存和管理多个案主的分析记录
- 🔍 **搜索功能**：快速查找历史分析记录

## 🛠️ 技术栈

### 后端
- Node.js + Express
- Gemini AI API
- 文件系统存储（JSON）

### 前端
- 原生 HTML/CSS/JavaScript
- Canvas API（命盘可视化）
- 中国传统美学设计

## 📦 安装步骤

### 1. 克隆或下载项目

```bash
cd /Users/jishudashen/Desktop/sm大师
```

### 2. 安装后端依赖

```bash
cd backend
npm install
```

### 3. 配置环境变量

复制 `.env.example` 为 `.env` 并配置：

```bash
cp ../.env.example ../.env
```

编辑 `.env` 文件，填入你的 Gemini API Key：

```
GEMINI_API_KEY=your_actual_api_key_here
PORT=3000
```

## 🚀 运行项目

### 启动后端服务器

```bash
cd backend
npm start
```

服务器将运行在 `http://localhost:3000`

### 访问前端界面

在浏览器中打开：
```
http://localhost:3000
```

## 📖 使用指南

### 1. 新建命盘分析

1. 在主页输入案主姓名（可选）
2. 粘贴文墨天机紫微斗数命盘文本数据
3. 点击"开始分析"按钮
4. 等待AI分析完成（约30-60秒）
5. 自动跳转到分析结果页面

### 2. 查看历史记录

- 主页下方显示所有历史分析记录
- 点击"查看"按钮查看详细分析
- 点击"删除"按钮删除记录
- 使用搜索框快速查找案主

### 3. 分析结果页面

分析结果包含以下内容：

- **命主信息**：基本出生信息、四柱、五行局等
- **命盘格局总论**：整体格局、性格特质、人生走向
- **十二宫位详解**：每个宫位的详细分析和关键词
- **命盘可视化**：十二宫位圆形图
- **流年运势**：2020-2035年的运势时间轴
- **专项分析**：事业财运、婚姻感情、健康养生、人际关系
- **化解建议**：化解方法、开运元素、人生规划

## 📁 项目结构

```
sm大师/
├── backend/                 # 后端代码
│   ├── server.js           # Express服务器
│   ├── parser.js           # 命盘文本解析器
│   ├── analyzer.js         # AI分析引擎
│   └── package.json        # 依赖配置
├── frontend/               # 前端代码
│   ├── index.html         # 主页
│   ├── analysis.html      # 分析结果页
│   ├── css/
│   │   └── style.css      # 样式文件
│   └── js/
│       ├── main.js        # 主页逻辑
│       ├── visualizer.js  # 命盘可视化
│       └── analysis.js    # 分析页逻辑
├── data/                   # 数据存储
│   └── analyses/          # 分析结果JSON文件
├── .env                    # 环境变量（需自行创建）
└── README.md              # 本文件
```

## 🔌 API 接口

### POST /api/analyze
分析命盘

**请求体：**
```json
{
  "text": "命盘文本数据",
  "name": "案主姓名"
}
```

**响应：**
```json
{
  "success": true,
  "id": "分析ID",
  "data": { ... }
}
```

### GET /api/analyses
获取所有分析列表

### GET /api/analysis/:id
获取特定分析详情

### DELETE /api/analysis/:id
删除分析记录

### GET /api/health
健康检查

## 🎨 界面预览

- **配色方案**：故宫红、金色、深色渐变背景
- **字体**：思源宋体、马善政毛笔字体
- **动画效果**：流光、悬停、渐变等
- **响应式设计**：支持桌面和移动端

## ⚠️ 注意事项

1. **API密钥**：需要有效的Gemini API密钥才能使用AI分析功能
2. **数据格式**：仅支持文墨天机格式的命盘文本
3. **免责声明**：本系统仅供研究和娱乐使用，不构成任何专业建议
4. **数据存储**：分析结果保存在本地文件系统中

## 🔧 故障排除

### 后端无法启动
- 检查Node.js版本（建议14.x或更高）
- 确认已运行 `npm install`
- 检查端口3000是否被占用

### AI分析失败
- 验证Gemini API密钥是否正确
- 检查网络连接
- 查看后端控制台错误信息

### 前端显示异常
- 清除浏览器缓存
- 检查浏览器控制台错误
- 确认后端服务器正在运行

## 📝 开发计划

- [ ] 添加PDF导出功能
- [ ] 支持更多命盘格式
- [ ] 数据库存储（替代文件系统）
- [ ] 用户认证系统
- [ ] 批量分析功能

## 📄 许可证

MIT License

## 👨‍💻 作者

紫微斗数分析系统开发团队

---

**免责声明**：本系统提供的所有分析结果仅限于研究或娱乐目的使用，不构成任何专业建议。人生命运掌握在自己手中，请理性看待。
